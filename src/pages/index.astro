---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

const episodes = (await getCollection("episodes")) as CollectionEntry<"episodes">[];

episodes.sort(
  (a: CollectionEntry<"episodes">, b: CollectionEntry<"episodes">) =>
    b.data.episode - a.data.episode
);

const latest = episodes[0];
const more = episodes.slice(1, 4); // next 3 episodes after latest
---

<BaseLayout title="Five Minutes in the Garden">
  <main class="home">
    <!-- HERO -->
    <section class="hero" aria-label="Site introduction">
      <img
        src="/images/five-minutes-in-the-garden-cover.jpg"
        alt="Five Minutes in the Garden"
        class="hero__image"
        loading="eager"
      />
    </section>

    <section class="home-frame">
      <div class="layout">
        <!-- LEFT SIDEBAR -->
        <aside class="rail rail--left" aria-label="Themes">
          <div class="rail-card">
            <p class="rail-title">In the Garden</p>
            <figure class="rail-figure" aria-label="Iconography: Saint John">
  <img
    class="rail-icon"
    src="/images/iconography/st-john-the-divine.jpg"
    alt="Saint John writing in the cave of Patmos"
    loading="lazy"
    decoding="async"
  />
</figure>

            <ul class="icon-list">
              <li class="icon-item">
                <span class="icon" aria-hidden="true">üåø</span>
                <span>Read</span>
              </li>
              <li class="icon-item">
                <span class="icon" aria-hidden="true">üïäÔ∏è</span>
                <span>Reflect</span>
              </li>
              <li class="icon-item">
                <span class="icon" aria-hidden="true">üôè</span>
                <span>Pray</span>
              </li>
              <li class="icon-item">
                <span class="icon" aria-hidden="true">‚õ™</span>
                <span>Return</span>
              </li>
            </ul>
          </div>
        </aside>

        <!-- CENTER CONTENT -->
        <section class="center">
          <!-- INTRO -->
          <section class="intro">
            <p class="intro-eyebrow">A daily pause</p>
            <p class="intro-lede">
              Five Minutes in the Garden is a gentle, daily devotional‚Äî
              an invitation to slow down, read Scripture,
              reflect, and pray.
            </p>
          </section>

          <hr class="divider" />

          <!-- TODAY / LATEST -->
          {latest && (
            <section class="home-section" aria-label="Today's reading">
              <p class="section-label">Today‚Äôs reading</p>

              <article class="episode-item episode-item--featured">
                <p class="episode-kicker">Episode {latest.data.episode}</p>

                <h2 class="episode-list-title">
                  <a href={`/episodes/${latest.slug}`}>{latest.data.title}</a>
                </h2>

                <p class="episode-meta">
                  {latest.data.passage} ¬∑ {latest.data.date}
                </p>

                {latest.data.summary && (
                  <p class="episode-summary">{latest.data.summary}</p>
                )}

                <nav class="episode-actions">
                  <a href={`/episodes/${latest.slug}`}>Read ‚Üí</a>
                </nav>
              </article>
            </section>
          )}

          <hr class="divider" />

          <!-- EXPLORE -->
          <section class="home-section" aria-label="Explore">
            <p class="section-label">Explore</p>

            <nav class="home-links">
              <a href="/episodes">Browse all episodes ‚Üí</a>
              <a href="/about">About ‚Üí</a>
              <a href="/contact">Contact ‚Üí</a>
            </nav>
          </section>
        </section>

        <!-- RIGHT SIDEBAR -->
        <aside class="rail rail--right" aria-label="More readings">
          <div class="rail-card">
            <p class="rail-title">More readings</p>
            <figure class="rail-figure" aria-label="Iconography: Christ the True Vine">
  <img
    class="rail-icon"
    src="/images/iconography/jesus-christ-the-true-vine.jpg"
    alt="Christ the True Vine with grape branches"
    loading="lazy"
    decoding="async"
  />
</figure>

            <div class="mini-list">
              {more.map((ep) => (
                <a class="mini-card" href={`/episodes/${ep.slug}`}>
                  <p class="mini-kicker">Episode {ep.data.episode}</p>
                  <p class="mini-title">{ep.data.title}</p>
                  <p class="mini-meta">
                    {ep.data.passage} ¬∑ {ep.data.date}
                  </p>
                </a>
              ))}
            </div>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <style>
    /* --------------------------------------------
       HERO
       -------------------------------------------- */

    .hero {
      width: 100%;
      max-width: min(1900px, 96vw);
      margin: 0 auto;
      height: clamp(220px, 36vh, 320px);
      overflow: hidden;
      border-radius: 16px;
      margin-bottom: clamp(0.75rem, 2vh, 1.25rem);
    }

    .hero__image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center 63%;
      display: block;
    }

    .hero {
  margin: 0.5rem auto 0;
}

    /* --------------------------------------------
       PAGE FRAME + 3-COLUMN LAYOUT
       -------------------------------------------- */

    .home-frame {
      max-width: min(1100px, 92vw);
      margin: 0 auto;
    }

    .layout {
      display: grid;
      gap: 1.25rem;
      align-items: start;
    }

    /* desktop: sidebars appear */
    @media (min-width: 980px) {
      .layout {
        grid-template-columns: 280px 1fr 290px;
      }
    }

    /* --------------------------------------------
       SIDE RAILS
       -------------------------------------------- */

    .rail {
      display: none;
    }

    @media (min-width: 980px) {
      .rail {
        display: block;
        position: sticky;
        top: 1.25rem;
      }
    }

    .rail-card {
      border: 1px solid var(--rule, #e7e7e7);
      border-radius: 16px;
      padding: 18px;
      background: rgba(0, 0, 0, 0.02);
    }

    .rail-title {
      font-family: var(--font-sans);
      font-size: 0.8rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      opacity: 0.8;
      margin: 0 0 0.75rem;
    }

    .icon-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.65rem;
      font-family: var(--font-sans);
    }

    .icon-item {
      display: flex;
      align-items: center;
      gap: 0.55rem;
      opacity: 0.92;
    }

    .rail-icon {
  display: block;
  width: 100%;
  max-height: 160px;          /* üîë this is the key */
  object-fit: cover;
  object-position: center;

  border-radius: 12px;
  opacity: 0.75;
  filter: saturate(0.85) contrast(0.95);

  border: 1px solid rgba(0, 0, 0, 0.08);
  background: rgba(255, 255, 255, 0.6);
}
.rail-figure {
  margin: 0.25rem 0 0.75rem;
}

    /* right mini episode cards */
    .mini-list {
      display: grid;
      gap: 0.65rem;
    }

    .mini-card {
      display: block;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      text-decoration: none;
      color: inherit;
      background: rgba(255, 255, 255, 0.65);
    }

    .mini-card:hover {
      background: rgba(255, 255, 255, 0.95);
    }

    .mini-kicker {
      font-family: var(--font-sans);
      font-size: 0.75rem;
      opacity: 0.7;
      margin: 0 0 0.25rem;
    }

    .mini-title {
      font-family: var(--font-serif);
      font-weight: 600;
      margin: 0 0 0.25rem;
      line-height: 1.2;
    }

    .mini-meta {
      font-family: var(--font-sans);
      font-size: 0.85rem;
      opacity: 0.72;
      margin: 0;
    }

    /* --------------------------------------------
       INTRO
       -------------------------------------------- */

    .intro {
      max-width: 42rem;
      margin: 0 auto 1.6rem;
    }

    .intro-eyebrow {
      font-family: var(--font-sans);
      font-size: 0.75rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      opacity: 0.6;
      margin-bottom: 0.6rem;
    }

    .intro-lede {
      font-family: var(--font-serif);
      font-size: 1.25rem;
      line-height: 1.6;
      margin: 0;
    }

    /* --------------------------------------------
       DIVIDERS + SECTIONS
       -------------------------------------------- */

    .divider {
      border: 0;
      height: 1px;
      background: linear-gradient(
        to right,
        transparent,
        rgba(0, 0, 0, 0.16),
        transparent
      );
      margin: 1.75rem 0 1.5rem;
    }

    .section-label {
      font-family: var(--font-sans);
      font-size: 0.85rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      opacity: 0.75;
      margin: 0 0 1rem;
    }

    /* --------------------------------------------
       Featured episode
       -------------------------------------------- */

    .episode-item--featured {
      margin-top: 0.25rem;
      border: 1px solid var(--rule, #e7e7e7);
      border-radius: 16px;
      background: rgba(0, 0, 0, 0.02);
      padding: 1.1rem;
    }

    .episode-kicker {
      font-family: var(--font-sans);
      font-size: 0.8rem;
      opacity: 0.75;
      margin: 0 0 0.4rem;
    }

    .episode-list-title {
      margin: 0.15rem 0 0.35rem;
      font-family: var(--font-serif);
      font-weight: 600;
      line-height: 1.2;
      font-size: 1.5rem;
    }

    .episode-list-title a {
      color: inherit;
      text-decoration: none;
    }

    .episode-list-title a:hover {
      text-decoration: underline;
    }

    .episode-meta {
      font-family: var(--font-sans);
      opacity: 0.78;
      margin: 0 0 0.5rem;
    }

    .episode-summary {
      margin: 0.6rem 0 0;
      font-family: var(--font-sans);
      opacity: 0.9;
    }

    .episode-actions {
      margin-top: 0.75rem;
      font-family: var(--font-sans);
    }

    .episode-actions a {
      color: inherit;
      text-decoration: none;
    }

    .episode-actions a:hover {
      text-decoration: underline;
    }

    /* --------------------------------------------
       Links
       -------------------------------------------- */

    .home-links {
      display: grid;
      gap: 0.75rem;
      margin-top: 0.25rem;
      font-family: var(--font-sans);
    }

    .home-links a {
      color: inherit;
      text-decoration: none;
    }

    .home-links a:hover {
      text-decoration: underline;
    }
  </style>
</BaseLayout>