---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

const episodes = (await getCollection("episodes")) as CollectionEntry<"episodes">[];

episodes.sort((a, b) => b.data.episode - a.data.episode);

const latest = episodes[0];
const more = episodes.slice(1, 4);
---

<BaseLayout
  title="Five Minutes in the Garden"
  description="A gentle, daily devotional‚Äîan invitation to slow down, read Scripture, reflect, and pray."
  image="/images/five-minutes-in-the-garden-cover.jpg"
>
  <main class="home">

    <!-- HERO -->
    <section class="hero" aria-label="Site introduction">
      <img
        src="/images/five-minutes-in-the-garden-cover.jpg"
        alt="Five Minutes in the Garden"
        class="hero__image"
        loading="eager"
      />
    </section>

    <!-- PAGE FRAME -->
    <section class="home-frame">
      <div class="layout">

        <!-- LEFT RAIL -->
        <aside class="rail rail--left" aria-label="In the Garden">
          <div class="rail-card">
            <p class="rail-title">In the Garden</p>

            <figure class="rail-figure">
              <img
                class="rail-icon"
                src="/images/iconography/st-john-the-divine.jpg"
                alt="Saint John writing in the cave of Patmos"
                loading="lazy"
              />
            </figure>

            <ul class="icon-list">
              <li>üåø Read</li>
              <li>üïäÔ∏è Reflect</li>
              <li>üôè Pray</li>
              <li>‚õ™ Return</li>
            </ul>
          </div>
        </aside>

        <!-- CENTER -->
        <section class="center">

          <!-- INTRO -->
          <section class="intro">
            <p class="intro-eyebrow">A daily pause</p>
            <p class="intro-lede">
              Five Minutes in the Garden is a gentle, daily devotional‚Äî
              an invitation to slow down, read Scripture, reflect, and pray.
            </p>
          </section>

          <hr class="divider" />

          <!-- TODAY -->
          {latest && (
            <section aria-label="Today‚Äôs reading">
              <p class="section-label">Today‚Äôs reading</p>

              <article class="episode-feature">
                <p class="episode-kicker">Episode {latest.data.episode}</p>

                <h2 class="episode-title">
                  <a href={`/episodes/${latest.slug}`}>{latest.data.title}</a>
                </h2>

                <p class="episode-meta">
                  {latest.data.passage} ¬∑ {latest.data.date}
                </p>

                {latest.data.summary && (
                  <p class="episode-summary">{latest.data.summary}</p>
                )}

                <a class="read-link" href={`/episodes/${latest.slug}`}>
                  Read ‚Üí
                </a>
              </article>
            </section>
          )}

          <hr class="divider" />

          <!-- EXPLORE -->
          <section aria-label="Explore">
            <p class="section-label">Explore</p>
            <nav class="home-links">
              <a href="/episodes">Browse all episodes ‚Üí</a>
              <a href="/tuesday">Tuesday Transformation ‚Üí</a>
              <a href="/about">About ‚Üí</a>
              <a href="/contact">Contact ‚Üí</a>
            </nav>
          </section>
        </section>

        <!-- RIGHT RAIL -->
        <aside class="rail rail--right" aria-label="More readings">
          <div class="rail-card">
            <p class="rail-title">More readings</p>

            <figure class="rail-figure">
              <img
                class="rail-icon"
                src="/images/iconography/jesus-christ-the-true-vine.jpg"
                alt="Christ the True Vine"
                loading="lazy"
              />
            </figure>

            <div class="mini-list">
              {more.map((ep) => (
                <a class="mini-card" href={`/episodes/${ep.slug}`}>
                  <p class="mini-kicker">Episode {ep.data.episode}</p>
                  <p class="mini-title">{ep.data.title}</p>
                  <p class="mini-meta">
                    {ep.data.passage} ¬∑ {ep.data.date}
                  </p>
                </a>
              ))}
            </div>
          </div>
        </aside>

      </div>
    </section>
  </main>

  <style>
    /* HERO */
    .hero {
      max-width: min(1100px, 92vw);
      margin: 0.5rem auto 1.25rem;
      height: clamp(220px, 32vh, 360px);
      overflow: hidden;
      border-radius: 18px;
    }

    .hero__image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center 62%;
      display: block;
    }

    /* FRAME */
    .home-frame {
      max-width: min(1100px, 92vw);
      margin: 0 auto;
    }

    .layout {
      display: grid;
      gap: 1.25rem;
    }

    @media (min-width: 980px) {
      .layout {
        grid-template-columns: 260px 1fr 280px;
      }
    }

    /* RAILS */
    .rail {
      display: none;
    }

    @media (min-width: 980px) {
      .rail {
        display: block;
        position: sticky;
        top: 1.25rem;
      }
    }

    .rail-card {
      border: 1px solid #e3e3e3;
      border-radius: 16px;
      padding: 16px;
      background: rgba(0,0,0,0.02);
    }

    .rail-title {
      font-size: 0.75rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      opacity: 0.75;
      margin-bottom: 0.75rem;
    }

    .rail-icon {
      width: 100%;
      max-height: 160px;
      object-fit: cover;
      border-radius: 12px;
      opacity: 0.85;
    }

    .icon-list {
      list-style: none;
      padding: 0;
      margin: 0.75rem 0 0;
      display: grid;
      gap: 0.5rem;
    }

    /* CENTER */
    .intro {
      max-width: 42rem;
      margin-bottom: 1.75rem;
    }

    .intro-eyebrow {
      font-size: 0.75rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      opacity: 0.6;
      margin-bottom: 0.5rem;
    }

    .intro-lede {
      font-size: 1.25rem;
      line-height: 1.6;
      margin: 0;
    }

    .divider {
      height: 1px;
      background: linear-gradient(
        to right,
        transparent,
        rgba(0,0,0,0.18),
        transparent
      );
      border: 0;
      margin: 1.75rem 0;
    }

    .section-label {
      font-size: 0.8rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      opacity: 0.7;
      margin-bottom: 1rem;
    }

    /* FEATURED EPISODE */
    .episode-feature {
      border: 1px solid #e5e5e5;
      border-radius: 16px;
      padding: 1.1rem;
      background: rgba(0,0,0,0.02);
    }

    .episode-kicker {
      font-size: 0.8rem;
      opacity: 0.7;
      margin-bottom: 0.4rem;
    }

    .episode-title {
      margin: 0.15rem 0 0.35rem;
      font-size: 1.5rem;
      line-height: 1.2;
    }

    .episode-title a {
      text-decoration: none;
      color: inherit;
    }

    .episode-title a:hover {
      text-decoration: underline;
    }

    .episode-meta {
      opacity: 0.75;
      margin-bottom: 0.5rem;
    }

    .episode-summary {
      margin: 0.6rem 0;
    }

    .read-link {
      text-decoration: none;
    }

    .read-link:hover {
      text-decoration: underline;
    }

    /* MORE READINGS */
    .mini-list {
      display: grid;
      gap: 0.65rem;
      margin-top: 0.75rem;
    }

    .mini-card {
      display: block;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.08);
      text-decoration: none;
      color: inherit;
      background: rgba(255,255,255,0.6);
    }

    .mini-card:hover {
      background: rgba(255,255,255,0.9);
    }

    .mini-kicker {
      font-size: 0.75rem;
      opacity: 0.7;
      margin-bottom: 0.2rem;
    }

    .mini-title {
      font-weight: 600;
      line-height: 1.2;
    }

    .mini-meta {
      font-size: 0.85rem;
      opacity: 0.7;
    }

    /* LINKS */
    .home-links {
      display: grid;
      gap: 0.75rem;
    }

    .home-links a {
      text-decoration: none;
    }

    .home-links a:hover {
      text-decoration: underline;
    }
  </style>
</BaseLayout>